{% extends "admin/base_site.html" %} {% load static %} {% block title
%}Statistiques - {{ quiz.title }}{% endblock %} {% block extrastyle %}
<style>
  .stats-container {
    padding: 20px;
    background: #f5f5f5;
  }

  .stats-header {
    background: white;
    padding: 20px;
    border-radius: 8px;
    margin-bottom: 20px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }

  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin: 30px 0;
  }

  .stat-card {
    padding: 20px;
    border-radius: 8px;
    text-align: center;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }

  .stat-card h2 {
    margin: 0;
    font-size: 2.5em;
    font-weight: bold;
  }

  .stat-card p {
    margin: 5px 0 0 0;
    color: #666;
    font-size: 0.9em;
  }

  .stat-card.blue {
    background: #e3f2fd;
  }
  .stat-card.blue h2 {
    color: #1976d2;
  }

  .stat-card.green {
    background: #e8f5e9;
  }
  .stat-card.green h2 {
    color: #388e3c;
  }

  .stat-card.orange {
    background: #fff3e0;
  }
  .stat-card.orange h2 {
    color: #f57c00;
  }

  .stat-card.purple {
    background: #f3e5f5;
  }
  .stat-card.purple h2 {
    color: #7b1fa2;
  }

  .stat-card.teal {
    background: #e0f2f1;
  }
  .stat-card.teal h2 {
    color: #00796b;
  }

  .content-section {
    background: white;
    padding: 20px;
    border-radius: 8px;
    margin: 30px 0;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }

  .content-section h2 {
    margin-top: 0;
    color: #333;
    border-bottom: 2px solid #e0e0e0;
    padding-bottom: 10px;
  }

  .data-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
  }

  .data-table thead tr {
    background: #f5f5f5;
    text-align: left;
  }

  .data-table th,
  .data-table td {
    padding: 12px;
    border-bottom: 1px solid #eee;
  }

  .data-table tbody tr:hover {
    background: #f9f9f9;
  }

  .badge {
    display: inline-block;
    padding: 4px 12px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: bold;
  }

  .badge.high-error {
    background: #ffebee;
    color: #c62828;
  }

  .badge.medium-error {
    background: #fff3e0;
    color: #f57c00;
  }

  .badge.low-error {
    background: #e8f5e9;
    color: #388e3c;
  }

  .badge.passed {
    background: #e8f5e9;
    color: #388e3c;
  }

  .badge.failed {
    background: #ffebee;
    color: #c62828;
  }

  .action-buttons {
    margin: 40px 0;
    padding: 20px;
    background: #f5f5f5;
    border-radius: 8px;
  }

  .action-buttons h3 {
    margin-top: 0;
  }

  .button-group {
    display: flex;
    gap: 10px;
    margin-top: 15px;
    flex-wrap: wrap;
  }

  .btn {
    padding: 10px 20px;
    text-decoration: none;
    border-radius: 4px;
    display: inline-block;
    font-weight: 500;
    border: none;
    cursor: pointer;
    transition: all 0.3s;
  }

  .btn:hover {
    opacity: 0.9;
    transform: translateY(-1px);
  }

  .btn-primary {
    background: #1976d2;
    color: white;
  }

  .btn-secondary {
    background: #666;
    color: white;
  }

  .btn-success {
    background: #388e3c;
    color: white;
  }

  .btn-warning {
    background: #f57c00;
    color: white;
  }

  .empty-state {
    background: #fff3e0;
    padding: 30px;
    border-radius: 8px;
    text-align: center;
    margin: 30px 0;
  }

  .empty-state h2 {
    color: #f57c00;
    margin-top: 0;
  }

  @media print {
    .breadcrumbs,
    #header,
    #footer,
    .action-buttons,
    button {
      display: none !important;
    }

    .stats-container {
      background: white;
    }
  }
</style>
{% endblock %} {% block content %}
<div class="stats-container">
  <!-- En-t√™te -->
  <div class="stats-header">
    <h1>üìä Statistiques du Quiz: {{ quiz.title }}</h1>
    <p>
      <strong>Mati√®re:</strong> {{ quiz.subject.name }} |
      <strong>Code:</strong> {{ quiz.subject.code }}
    </p>
    <p>
      <strong>Cr√©√© le:</strong> {{ quiz.created_at|date:"d/m/Y" }} |
      <strong>Dur√©e:</strong> {{ quiz.duration_minutes }} minutes |
      <strong>Score minimum:</strong> {{ quiz.passing_score }}/{{
      quiz.total_points }}
    </p>
  </div>

  <!-- Statistiques globales -->
  <div class="stats-grid">
    <div class="stat-card blue">
      <h2>{{ total_attempts }}</h2>
      <p>Total tentatives</p>
    </div>

    <div class="stat-card green">
      <h2>{{ completed_attempts }}</h2>
      <p>Tentatives compl√©t√©es</p>
    </div>

    {% if average_score %}
    <div class="stat-card orange">
      <h2>{{ average_score|floatformat:2 }}/{{ quiz.total_points }}</h2>
      <p>Note moyenne</p>
    </div>

    <div class="stat-card purple">
      <h2>{{ pass_rate|floatformat:1 }}%</h2>
      <p>Taux de r√©ussite</p>
    </div>

    <div class="stat-card teal">
      <h2>{{ passed_count }}/{{ completed_attempts }}</h2>
      <p>√âtudiants ayant r√©ussi</p>
    </div>
    {% endif %} {% if in_progress %}
    <div class="stat-card orange">
      <h2>{{ in_progress }}</h2>
      <p>En cours</p>
    </div>
    {% endif %} {% if abandoned %}
    <div class="stat-card" style="background: #fce4ec">
      <h2 style="color: #c2185b">{{ abandoned }}</h2>
      <p>Abandonn√©es</p>
    </div>
    {% endif %}
  </div>

  {% if average_score %}
  <!-- Questions les plus difficiles -->
  <div class="content-section">
    <h2>‚ùå Questions les plus difficiles</h2>
    <p style="color: #666; margin-bottom: 20px">
      Questions avec le plus grand taux d'erreur
    </p>

    <table class="data-table">
      <thead>
        <tr>
          <th style="width: 50%">Question</th>
          <th style="text-align: center">Type</th>
          <th style="text-align: center">Total r√©ponses</th>
          <th style="text-align: center">Bonnes r√©ponses</th>
          <th style="text-align: center">Taux d'erreur</th>
        </tr>
      </thead>
      <tbody>
        {% for stat in question_stats %}
        <tr>
          <td>
            <strong>Q{{ stat.question.order }}:</strong>
            {{ stat.question.text|truncatewords:15 }}
          </td>
          <td style="text-align: center">
            <span
              style="
                background: #e3f2fd;
                padding: 4px 8px;
                border-radius: 4px;
                font-size: 12px;
              "
            >
              {{ stat.question.get_question_type_display }}
            </span>
          </td>
          <td style="text-align: center">{{ stat.total_answers }}</td>
          <td style="text-align: center">
            <span style="color: green; font-weight: bold"
              >{{ stat.correct_answers }}</span
            >
          </td>
          <td style="text-align: center">
            {% if stat.error_rate > 50 %}
            <span class="badge high-error">
              {{ stat.error_rate|floatformat:1 }}%
            </span>
            {% elif stat.error_rate > 30 %}
            <span class="badge medium-error">
              {{ stat.error_rate|floatformat:1 }}%
            </span>
            {% else %}
            <span class="badge low-error">
              {{ stat.error_rate|floatformat:1 }}%
            </span>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Tentatives r√©centes -->
  <div class="content-section">
    <h2>üìù Tentatives r√©centes</h2>
    <p style="color: #666; margin-bottom: 20px">
      Les 10 derni√®res tentatives compl√©t√©es
    </p>

    <table class="data-table">
      <thead>
        <tr>
          <th>√âtudiant</th>
          <th style="text-align: center">Tentative</th>
          <th style="text-align: center">Score</th>
          <th style="text-align: center">R√©sultat</th>
          <th>Date</th>
        </tr>
      </thead>
      <tbody>
        {% for attempt in recent_attempts %}
        <tr>
          <td>
            <strong
              >{{ attempt.user.get_full_name|default:attempt.user.username
              }}</strong
            >
            <br />
            <span style="color: #666; font-size: 12px"
              >{{ attempt.user.email }}</span
            >
          </td>
          <td style="text-align: center">
            <span
              style="
                background: #f5f5f5;
                padding: 4px 8px;
                border-radius: 4px;
                font-size: 12px;
              "
            >
              #{{ attempt.attempt_number }}
            </span>
          </td>
          <td style="text-align: center">
            <strong style="font-size: 16px"
              >{{ attempt.score }}/{{ quiz.total_points }}</strong
            >
          </td>
          <td style="text-align: center">
            {% if attempt.is_passed %}
            <span class="badge passed"> ‚úì R√©ussi </span>
            {% else %}
            <span class="badge failed"> ‚úó √âchou√© </span>
            {% endif %}
          </td>
          <td>
            {{ attempt.completed_at|date:"d/m/Y H:i" }}
            <br />
            <span style="color: #666; font-size: 12px">
              Dur√©e: {{ attempt.time_spent|floatformat:0 }} min
            </span>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
  <!-- √âtat vide -->
  <div class="empty-state">
    <h2>üì≠ Aucune tentative compl√©t√©e</h2>
    <p style="color: #666">
      Les statistiques seront disponibles une fois que des √©tudiants auront
      compl√©t√© le quiz.
    </p>
  </div>
  {% endif %}

  <!-- Actions -->
  <div class="action-buttons">
    <h3>Actions disponibles</h3>
    <div class="button-group">
      <a
        href="{% url 'admin:courses_quiz_change' quiz.id %}"
        class="btn btn-primary"
      >
        ‚úèÔ∏è Modifier le quiz
      </a>

      <a
        href="{% url 'admin:courses_quiz_changelist' %}"
        class="btn btn-secondary"
      >
        ‚Üê Retour √† la liste
      </a>

      {% if completed_attempts > 0 %}
      <a
        href="{% url 'admin:courses_quizattempt_changelist' %}?quiz__id__exact={{ quiz.id }}&status__exact=COMPLETED"
        class="btn btn-success"
      >
        üë• Voir toutes les tentatives
      </a>

      <button onclick="window.print()" class="btn btn-warning">
        üñ®Ô∏è Imprimer les statistiques
      </button>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
